{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","ng://ngx-document-scanner/lib/services/limits.service.ts","ng://ngx-document-scanner/lib/components/draggable-point/ngx-draggable-point.component.ts","ng://ngx-document-scanner/lib/components/filter-menu/ngx-filter-menu.component.ts","ng://ngx-document-scanner/lib/components/shape-outline/ngx-shape-outline.component.ts","ng://ngx-document-scanner/lib/components/image-editor/ngx-doc-scanner.component.ts","ng://ngx-document-scanner/lib/ngx-document-scanner.module.ts"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","this","n","v","op","TypeError","call","pop","length","push","Object","create","__read","o","m","r","i","ar","error","__spread","arguments","concat","LimitsService","limitDirections","_limits","top","bottom","right","left","_points","positions","BehaviorSubject","Array","from","repositionEvent","limits","paneDimensions","width","height","prototype","setPaneDimensions","dimensions","_this","_paneDimensions","repositionPoints","forEach","position","positionChange","positionChangeData","updatePosition","direction","limit","relevantPoints","filter","point","roles","includes","map","getDirectionAxis","Math","max","min","index","findIndex","compareArray","splice","exceedsLimit","pointLimits","limitException","exceeds","resetCoefficients","x","resetCoordinates","directionAxis","rotateClockwise","resizeRatios","initialPreviewDimensions","initialPositions","PositionChangeData","rotateCornerClockwise","corner","rotated","order","array1","array2","every","element","Injectable","args","providedIn","NgxDraggablePointComponent","limitsService","color","shape","pointOptions","ngAfterViewInit","keys","key","subscribe","getInitialPosition","limitRoles","externalReposition","pointStyle","background-color","border-radius","resetPosition","_currentPosition","adjustPosition","newPosition","startPosition","axis","movementEnd","enforcePaneLimits","Component","selector","template","Input","NgxFilterMenuComponent","bottomSheetRef","data","filterOptions","name","icon","action","filterSelected","emit","text","EventEmitter","selectOption","optionName","dismiss","MatBottomSheetRef","Inject","MAT_BOTTOM_SHEET_DATA","Output","NgxShapeOutlineComponent","canvas","nativeElement","sortPoints","clearCanvas","drawShape","setTimeout","getContext","clearRect","sortedPoints","sortOrder","vertical","horizontal","_sortedPoints","ctx","lineWidth","weight","strokeStyle","beginPath","moveTo","nextPoint","lineTo","closePath","stroke","ViewChild","NgxDocScannerComponent","ngxOpenCv","bottomSheet","editorButtons","exitEditor","type","mode","rotateImage","bind","transform","_a","applyFilter","loadFile","originalImage","chooseFilters","exportImage","imageLoaded","selectedFilter","imageDimensions","editResult","ready","processing","screenDimensions","window","innerWidth","innerHeight","cvState","state","Error","loading","points","defineProperty","button","file","ngOnInit","options","ImageEditorConfig","config","exportImageIcon","maxPreviewWidth","editorStyle","exit","maxImageDimensions","resize","editedImage","resizeResult","toBlob","blob","open","afterDismissed","readImage","console","err_1","showPreview","err_2","previewDimensions","detectContours","reader","FileReader","onload","event","onerror","err","readAsDataURL","imageSrc","err_3","img","Image","document","createElement","drawImage","_b","setPreviewPaneDimensions","src","dst","cv","imread","transpose","flip","imshow","delete","assign","previewResizeRatios","ksize","Size","rows","cols","cvtColor","COLOR_RGBA2GRAY","GaussianBlur","BORDER_DEFAULT","Canny","threshold","THRESH_BINARY","contours","MatVector","hierarchy","Mat","findContours","RETR_CCOMP","CHAIN_APPROX_SIMPLE","rect","boundingRect","imageResizeRatio","contourCoordinates","sourceCoordinates","getPoint","bottomWidth","topWidth","maxWidth","leftHeight","rightHeight","maxHeight","destCoordinates","Ms","matFromArray","CV_32FC2","Md","transformMatrix","getPerspectiveTransform","dsize","warpPerspective","INTER_LINEAR","BORDER_CONSTANT","Scalar","preview","blur","th","thMode","ADAPTIVE_THRESH_MEAN_C","thMeanCorrection","thBlockSize","thMax","grayScale","ADAPTIVE_THRESH_GAUSSIAN_C","adaptiveThreshold","convertTo","image","currentDimensions","size","resizeDimensions","floor","INTER_AREA","previewCanvas","calculateDimensions","imageDivStyle","cropToolDimensions","margin-left","margin-right","ratio","calculated","round","find","NgxOpenCVService","MatBottomSheet","read","ElementRef","editorBackgroundColor","editorDimensions","extraCss","buttonThemeColor","cropToolColor","cropToolShape","cropToolLineWeight","NgxDocumentScannerModule","forRoot","ngModule","providers","provide","OpenCvConfigToken","useValue","NgModule","declarations","imports","FlexLayoutModule","MatButtonModule","MatIconModule","MatBottomSheetModule","MatListModule","AngularDraggableModule","CommonModule","NgxOpenCVModule","exports","entryComponents"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) __createBinding(exports, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import {Injectable} from '@angular/core';\nimport {BehaviorSubject} from 'rxjs';\nimport {ImageDimensions} from '../PublicModels';\nimport {LimitException, XYPosition} from '../PrivateModels';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LimitsService {\n\n\n  private limitDirections: RolesArray = ['left', 'right', 'top', 'bottom'];\n  /**\n   * stores the crop limits limits\n   */\n  private _limits = {\n    top: 0,\n    bottom: 0,\n    right: 0,\n    left: 0\n  };\n  /**\n   * stores the array of the draggable points displayed on the crop area\n   */\n  private _points: Array<PointPositionChange> = [];\n  /**\n   * stores the pane dimensions\n   */\n  private _paneDimensions: ImageDimensions;\n\n  // *********** //\n  // Observables //\n  // *********** //\n  public positions: BehaviorSubject<Array<PointPositionChange>> = new BehaviorSubject<Array<PointPositionChange>>(Array.from(this._points));\n  public repositionEvent: BehaviorSubject<Array<PointPositionChange>> = new BehaviorSubject<Array<PointPositionChange>>([]);\n  public limits: BehaviorSubject<AreaLimits> = new BehaviorSubject<AreaLimits>(this._limits);\n  public paneDimensions: BehaviorSubject<ImageDimensions> = new BehaviorSubject({width: 0, height: 0});\n\n  constructor() {\n  }\n\n  /**\n   * set privew pane dimensions\n   */\n  public setPaneDimensions(dimensions: ImageDimensions) {\n    return new Promise((resolve, reject) => {\n      this._paneDimensions = dimensions;\n      this.paneDimensions.next(dimensions);\n      resolve();\n    });\n  }\n\n  /**\n   * repositions points externally\n   */\n  public repositionPoints(positions) {\n    this._points = positions;\n    positions.forEach(position => {\n      this.positionChange(position);\n    });\n    this.repositionEvent.next(positions);\n  }\n\n  /**\n   * updates limits and point positions and calls next on the observables\n   * @param positionChangeData - position change event data\n   */\n  public positionChange(positionChangeData: PointPositionChange) {\n    // update positions according to current position change\n    this.updatePosition(positionChangeData);\n\n    // for each direction:\n    // 1. filter the _points that have a role as the direction's limit\n    // 2. for top and left find max x | y values, and min for right and bottom\n    this.limitDirections.forEach(direction => {\n      const relevantPoints = this._points.filter(point => {\n        return point.roles.includes(direction);\n      })\n        .map((point: PointPositionChange) => {\n          return point[this.getDirectionAxis(direction)];\n        });\n      let limit;\n      if (direction === 'top' || direction === 'left') {\n        limit = Math.max(...relevantPoints);\n      }\n      if (direction === 'right' || direction === 'bottom') {\n        limit = Math.min(...relevantPoints);\n      }\n      this._limits[direction] = limit;\n    });\n\n    this.limits.next(this._limits);\n    this.positions.next(Array.from(this._points));\n  }\n\n  /**\n   * updates the position of the point\n   * @param positionChange - position change event data\n   */\n  public updatePosition(positionChange: PointPositionChange) {\n    // finds the current position of the point by it's roles, than splices it for the new position or pushes it if it's not yet in the array\n    const index = this._points.findIndex(point => {\n      return this.compareArray(positionChange.roles, point.roles);\n    });\n    if (index === -1) {\n      this._points.push(positionChange);\n    } else {\n      this._points.splice(index, 1, positionChange);\n    }\n  }\n\n  /**\n   * check if a position change event exceeds the limits\n   * @param positionChange - position change event data\n   * @returns LimitException0\n   */\n  public exceedsLimit(positionChange: PointPositionChange): LimitException {\n    const pointLimits = this.limitDirections.filter(direction => {\n      return !positionChange.roles.includes(direction);\n    });\n\n    const limitException: LimitException = {\n      exceeds: false,\n      resetCoefficients: {\n        x: 0,\n        y: 0\n      },\n      resetCoordinates: {\n        x: positionChange.x,\n        y: positionChange.y\n      }\n    };\n\n    // limit directions are the opposite sides of the point's roles\n    pointLimits.forEach(direction => {\n      const directionAxis = this.getDirectionAxis(direction);\n      if (direction === 'top' || direction === 'left') {\n        if (positionChange[directionAxis] < this._limits[direction]) {\n          limitException.resetCoefficients[directionAxis] = 1;\n          limitException.resetCoordinates[directionAxis] = this._limits[direction];\n        }\n      } else if (direction === 'right' || direction === 'bottom') {\n        if (positionChange[directionAxis] > this._limits[direction]) {\n          limitException.resetCoefficients[directionAxis] = -1;\n          limitException.resetCoordinates[directionAxis] = this._limits[direction];\n        }\n      }\n    });\n\n    if (limitException.resetCoefficients.x !== 0 || limitException.resetCoefficients.y !== 0) {\n      limitException.exceeds = true;\n    }\n\n    return limitException;\n  }\n\n  /**\n   * rotate crop tool points clockwise\n   * @param resizeRatios - ratio between the new dimensions and the previous\n   * @param initialPreviewDimensions - preview pane dimensions before rotation\n   * @param initialPositions - current positions before rotation\n   */\n  public rotateClockwise(resizeRatios, initialPreviewDimensions, initialPositions: Array<PointPositionChange>) {\n    // convert positions to ratio between position to initial pane dimension\n    initialPositions = initialPositions.map(point => {\n      return new PositionChangeData({\n        x: point.x / initialPreviewDimensions.width,\n        y: point.y / initialPreviewDimensions.height,\n      }, point.roles);\n    });\n    this.repositionPoints(initialPositions.map(point => {\n      return this.rotateCornerClockwise(point);\n    }));\n  }\n\n  /**\n   * returns the corner positions after a 90 degrees clockwise rotation\n   */\n  private rotateCornerClockwise(corner: PointPositionChange): PointPositionChange {\n    const rotated: PointPositionChange = {\n      x: this._paneDimensions.width * (1 - corner.y),\n      y: this._paneDimensions.height * corner.x,\n      roles: []\n    };\n    // rotates corner according to order\n    const order: Array<RolesArray> = [\n      ['bottom', 'left'],\n      ['top', 'left'],\n      ['top', 'right'],\n      ['bottom', 'right'],\n      ['bottom', 'left']\n    ];\n    rotated.roles = order[order.findIndex(roles => {\n      return this.compareArray(roles, corner.roles);\n    }) + 1];\n    return rotated;\n  }\n\n  /**\n   * checks if two array contain the same values\n   * @param array1 - array 1\n   * @param array2 - array 2\n   * @returns boolean\n   */\n  public compareArray(array1: Array<string>, array2: Array<string>): boolean {\n    return array1.every((element) => {\n      return array2.includes(element);\n    }) && array1.length === array2.length;\n  }\n\n  private getDirectionAxis(direction) {\n    return {\n      left: 'x',\n      right: 'x',\n      top: 'y',\n      bottom: 'y'\n    }[direction];\n  }\n}\n\n\nexport interface PointPositionChange {\n  x: number;\n  y: number;\n  roles: RolesArray;\n}\n\nexport interface AreaLimits {\n  top: number;\n  bottom: number;\n  right: number;\n  left: number;\n}\n\nexport type RolesArray = Array<Direction>;\n\nexport class PositionChangeData implements PointPositionChange {\n  x: number;\n  y: number;\n  roles: RolesArray;\n\n  constructor(position: XYPosition, roles: RolesArray) {\n    this.x = position.x;\n    this.y = position.y;\n    this.roles = roles;\n  }\n}\n\nexport type Direction = 'left' | 'right' | 'top' | 'bottom';\n","import {AfterViewInit, Component, Input} from '@angular/core';\nimport {LimitsService, PointPositionChange, PositionChangeData} from '../../services/limits.service';\nimport {ImageDimensions} from '../../PublicModels';\nimport {LimitException, XYPosition} from '../../PrivateModels';\n\n@Component({\n  selector: 'ngx-draggable-point',\n  templateUrl: './ngx-draggable-point.component.html',\n})\nexport class NgxDraggablePointComponent implements AfterViewInit {\n  @Input() width = 10;\n  @Input() height = 10;\n  @Input() color = '#3cabe2';\n  @Input() shape: 'rect' | 'circle' = 'rect';\n  @Input() pointOptions: 'rect' | 'circle' = 'rect';\n  @Input() limitRoles: Array<'left'|'right'|'top'|'bottom'>;\n  @Input() startPosition: XYPosition;\n  @Input() container: HTMLElement;\n  @Input() private _currentPosition: XYPosition;\n  position: XYPosition = {\n    x: 0,\n    y: 0\n  };\n  private _paneDimensions: ImageDimensions;\n  resetPosition: XYPosition;\n\n  constructor(private limitsService: LimitsService) {}\n\n  ngAfterViewInit() {\n    Object.keys(this.pointOptions).forEach(key => {\n      this[key] = this.pointOptions[key];\n    });\n    // subscribe to pane dimensions changes\n    this.limitsService.paneDimensions.subscribe(dimensions => {\n      if (dimensions.width > 0 && dimensions.width > 0) {\n        this._paneDimensions = {\n          width: dimensions.width,\n          height: dimensions.height\n        };\n        this.position = this.getInitialPosition(dimensions);\n        this.limitsService.positionChange(new PositionChangeData(this.position, this.limitRoles));\n      }\n    });\n    // subscribe to external reposition events\n    this.limitsService.repositionEvent.subscribe(positions => {\n      if (positions.length > 0) {\n        this.externalReposition(positions);\n      }\n    });\n  }\n\n  /**\n   * returns a css style object for the point\n   */\n  pointStyle() {\n    return {\n      width: this.width + 'px',\n      height: this.height + 'px',\n      'background-color': this.color,\n      'border-radius': this.shape === 'circle' ? '100%' : 0,\n      position: 'absolute'\n    };\n  }\n\n  /**\n   * registers a position change on the limits service, and adjusts position if necessary\n   * @param position - the current position of the point\n   */\n  positionChange(position: XYPosition) {\n    const positionChangeData = new PositionChangeData(position, this.limitRoles);\n    const limitException = this.limitsService.exceedsLimit(positionChangeData);\n    if (limitException.exceeds) {\n      // if exceeds limits, reposition\n      this.resetPosition = limitException.resetCoordinates;\n    } else {\n      this.limitsService.positionChange(positionChangeData);\n      this._currentPosition = position;\n    }\n  }\n\n  /**\n   * adjusts the position of the point after a limit exception\n   */\n  private adjustPosition(limitException: LimitException) {\n    const newPosition = {\n      x: 0,\n      y: 0\n    };\n    Object.keys(this.startPosition).forEach(axis => {\n      newPosition[axis] = limitException.resetCoordinates[axis] + limitException.resetCoefficients[axis];\n    });\n    this.position = newPosition;\n    this.limitsService.positionChange(new PositionChangeData(this.position, this.limitRoles));\n  }\n\n  /**\n   * called on movement end, checks if last position exceeded the limits ad adjusts\n   */\n  movementEnd(position: XYPosition) {\n    let positionChangeData = new PositionChangeData(position, this.limitRoles);\n    const limitException = this.limitsService.exceedsLimit(positionChangeData);\n    if (limitException.exceeds) {\n      this.resetPosition = limitException.resetCoordinates;\n      if (limitException.exceeds) {\n        this.adjustPosition(limitException);\n        positionChangeData = new PositionChangeData(this.position, this.limitRoles);\n        this.limitsService.updatePosition(positionChangeData);\n      }\n    }\n  }\n\n  /**\n   * calculates the initial positions of the point by it's roles\n   * @param dimensions - dimensions of the pane in which the point is located\n   */\n  private getInitialPosition(dimensions: ImageDimensions) {\n    return {\n      x: this.limitRoles.includes('left') ? 0 : dimensions.width - this.width / 2,\n      y: this.limitRoles.includes('top') ? 0 : dimensions.height - this.height / 2\n    };\n  }\n\n  /**\n   * repositions the point after an external reposition event\n   * @param positions - an array of all points on the pane\n   */\n  private externalReposition(positions: Array<PointPositionChange>) {\n    positions.forEach(position => {\n      if (this.limitsService.compareArray(this.limitRoles, position.roles)) {\n        position = this.enforcePaneLimits(position);\n        this.position = {\n          x: position.x,\n          y: position.y\n        };\n      }\n    });\n  }\n\n  /**\n   * returns a new point position if the movement exceeded the pane limit\n   */\n  private enforcePaneLimits(position: PointPositionChange): PointPositionChange {\n    if (this._paneDimensions.width === 0 || this._paneDimensions.height === 0) {\n      return position;\n    } else {\n      if (position.x > this._paneDimensions.width) { position.x = this._paneDimensions.width; }\n      if (position.x < 0) { position.x = 1; }\n      if (position.y > this._paneDimensions.height) { position.y = this._paneDimensions.height; }\n      if (position.y < 0) { position.y = 1; }\n    }\n    return position;\n  }\n}\n\n","import {Component, EventEmitter, Inject, Output} from '@angular/core';\nimport {EditorActionButton} from '../../PrivateModels';\nimport {MAT_BOTTOM_SHEET_DATA, MatBottomSheetRef} from '@angular/material/bottom-sheet';\n\n@Component({\n  selector: 'ngx-filter-menu',\n  templateUrl: './ngx-filter-menu.component.html',\n})\nexport class NgxFilterMenuComponent {\n  filterOptions: Array<EditorActionButton> = [\n    {\n      name: 'default',\n      icon: 'filter_b_and_w',\n      action: (filter) => {\n        this.filterSelected.emit(filter);\n      },\n      text: 'B&W'\n    },\n    {\n      name: 'bw2',\n      icon: 'filter_b_and_w',\n      action: (filter) => {\n        this.filterSelected.emit(filter);\n      },\n      text: 'B&W 2'\n    },\n    {\n      name: 'bw3',\n      icon: 'blur_on',\n      action: (filter) => {\n        this.filterSelected.emit(filter);\n      },\n      text: 'B&W 3'\n    },\n    {\n      name: 'magic_color',\n      icon: 'filter_vintage',\n      action: (filter) => {\n        this.filterSelected.emit(filter);\n      },\n      text: 'Magic Color'\n    },\n    {\n      name: 'original',\n      icon: 'crop_original',\n      action: (filter) => {\n        this.filterSelected.emit(filter);\n      },\n      text: 'Original'\n    },\n  ];\n  @Output() filterSelected: EventEmitter<string> = new EventEmitter();\n  selectOption(optionName) {\n    this.data.filter = optionName;\n    this.bottomSheetRef.dismiss();\n  }\n\n  constructor(private bottomSheetRef: MatBottomSheetRef<NgxFilterMenuComponent>,\n              @Inject(MAT_BOTTOM_SHEET_DATA) public data: any\n              ) {}\n\n}\n","import {AfterViewInit, Component, Input, ViewChild} from '@angular/core';\nimport {LimitsService, PointPositionChange} from '../../services/limits.service';\nimport {ImageDimensions} from '../../PublicModels';\n\n@Component({\n  selector: 'ngx-shape-outine',\n  templateUrl: './ngx-shape-outline.component.html',\n})\nexport class NgxShapeOutlineComponent implements AfterViewInit {\n\n  @Input() color = '#3cabe2';\n  @Input() weight: number;\n  @Input() dimensions: ImageDimensions;\n  @ViewChild('outline') canvas;\n\n  private _points: Array<PointPositionChange>;\n  private _sortedPoints: Array<PointPositionChange>;\n  constructor(private limitsService: LimitsService) {}\n\n  ngAfterViewInit() {\n    // init drawing canvas dimensions\n    this.canvas.nativeElement.width = this.dimensions.width;\n    this.canvas.nativeElement.height = this.dimensions.height;\n    this.limitsService.positions.subscribe(positions => {\n      if (positions.length === 4) {\n        this._points = positions;\n        this.sortPoints();\n        this.clearCanvas();\n        this.drawShape();\n      }\n    });\n    // subscribe to changes in the pane's dimensions\n    this.limitsService.paneDimensions.subscribe(dimensions => {\n      this.clearCanvas();\n      this.canvas.nativeElement.width = dimensions.width;\n      this.canvas.nativeElement.height = dimensions.height;\n    });\n    // subscribe to reposition events\n    this.limitsService.repositionEvent.subscribe( positions => {\n      if (positions.length === 4) {\n        setTimeout( () => {\n          this.clearCanvas();\n          this.sortPoints();\n          this.drawShape();\n        }, 10);\n      }\n    });\n  }\n\n  /**\n   * clears the shape canvas\n   */\n  private clearCanvas() {\n    const canvas = this.canvas.nativeElement;\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, this.dimensions.width, this.dimensions.height);\n  }\n\n  /**\n   * sorts the array of points according to their clockwise alignment\n   */\n  private sortPoints() {\n    const _points = Array.from(this._points);\n    const sortedPoints = [];\n\n    const sortOrder = {\n      vertical: ['top', 'top', 'bottom', 'bottom'],\n      horizontal: ['left', 'right', 'right', 'left']\n    };\n\n    for (let i = 0; i < 4; i++) {\n      const roles = Array.from([sortOrder.vertical[i], sortOrder.horizontal[i]]);\n      sortedPoints.push(_points.filter((point) => {\n        return this.limitsService.compareArray(point.roles, roles);\n      })[0]);\n\n    }\n    this._sortedPoints = sortedPoints;\n  }\n\n  /**\n   * draws a line between the points according to their order\n   */\n  private drawShape() {\n    const canvas = this.canvas.nativeElement;\n    const ctx = canvas.getContext('2d');\n    ctx.lineWidth = this.weight;\n    ctx.strokeStyle = this.color;\n    ctx.beginPath();\n    this._sortedPoints.forEach((point, index) => {\n      if (index === 0) {\n        ctx.moveTo(point.x, point.y);\n      }\n      if (index !== this._sortedPoints.length - 1) {\n        const nextPoint = this._sortedPoints[index + 1];\n        ctx.lineTo(nextPoint.x, nextPoint.y);\n      } else {\n        ctx.closePath();\n      }\n    });\n    ctx.stroke();\n  }\n}\n\n\n","import {Component, ElementRef, EventEmitter, Input, OnInit, Output, ViewChild} from '@angular/core';\nimport {LimitsService, PointPositionChange, PositionChangeData, RolesArray} from '../../services/limits.service';\nimport {MatBottomSheet} from '@angular/material/bottom-sheet';\nimport {NgxFilterMenuComponent} from '../filter-menu/ngx-filter-menu.component';\nimport {PointShape} from '../../PrivateModels';\n// import {NgxOpenCVService} from '../../services/ngx-opencv.service';\nimport {ImageDimensions, DocScannerConfig, OpenCVState} from '../../PublicModels';\nimport {EditorActionButton, PointOptions} from '../../PrivateModels';\nimport {NgxOpenCVService} from 'ngx-opencv';\n\ndeclare var cv: any;\n\n@Component({\n  selector: 'ngx-doc-scanner',\n  templateUrl: './ngx-doc-scanner.component.html',\n  styleUrls: ['./ngx-doc-scanner.component.scss']\n})\nexport class NgxDocScannerComponent implements OnInit {\n  /**\n   * editor config object\n   */\n  options: ImageEditorConfig;\n  // ************* //\n  // EDITOR CONFIG //\n  // ************* //\n  /**\n   * an array of action buttons displayed on the editor screen\n   */\n  private editorButtons: Array<EditorActionButton> = [\n    {\n      name: 'exit',\n      action: () => {\n        this.exitEditor.emit('canceled');\n      },\n      icon: 'arrow_back',\n      type: 'fab',\n      mode: 'crop'\n    },\n    {\n      name: 'rotate',\n      action: this.rotateImage.bind(this),\n      icon: 'rotate_right',\n      type: 'fab',\n      mode: 'crop'\n    },\n    {\n      name: 'done_crop',\n      action: async () => {\n        this.mode = 'color';\n        await this.transform();\n        await this.applyFilter(true);\n      },\n      icon: 'done',\n      type: 'fab',\n      mode: 'crop'\n    },\n    {\n      name: 'back',\n      action: () => {\n        this.mode = 'crop';\n        this.loadFile(this.originalImage);\n      },\n      icon: 'arrow_back',\n      type: 'fab',\n      mode: 'color'\n    },\n    {\n      name: 'filter',\n      action: () => {\n        return this.chooseFilters();\n      },\n      icon: 'photo_filter',\n      type: 'fab',\n      mode: 'color'\n    },\n    {\n      name: 'upload',\n      action: this.exportImage.bind(this),\n      icon: 'cloud_upload',\n      type: 'fab',\n      mode: 'color'\n    },\n  ];\n  /**\n   * returns an array of buttons according to the editor mode\n   */\n  get displayedButtons() {\n    return this.editorButtons.filter(button => {\n      return button.mode === this.mode;\n    });\n  }\n  /**\n   * max width of the preview area\n   */\n  private maxPreviewWidth: number;\n  /**\n   * dimensions of the image container\n   */\n  imageDivStyle: {[key: string]: string|number};\n  /**\n   * editor div style\n   */\n  editorStyle: {[key: string]: string|number};\n\n  // ************* //\n  // EDITOR STATE //\n  // ************* //\n  /**\n   * state of opencv loading\n   */\n  private cvState: string;\n  /**\n   * true after the image is loaded and preview is displayed\n   */\n  imageLoaded = false;\n  /**\n   * editor mode\n   */\n  mode: 'crop'|'color' = 'crop';\n  /**\n   * filter selected by the user, returned by the filter selector bottom sheet\n   */\n  private selectedFilter = 'default';\n\n  // ******************* //\n  // OPERATION VARIABLES //\n  // ******************* //\n  /**\n   * viewport dimensions\n   */\n  private screenDimensions: ImageDimensions;\n  /**\n   * image dimensions\n   */\n  private imageDimensions: ImageDimensions = {\n    width: 0,\n    height: 0\n  };\n  /**\n   * dimensions of the preview pane\n   */\n  previewDimensions: ImageDimensions;\n  /**\n   * ration between preview image and original\n   */\n  private imageResizeRatio: number;\n  /**\n   * stores the original image for reset purposes\n   */\n  private originalImage: File;\n  /**\n   * stores the edited image\n   */\n  private editedImage: HTMLCanvasElement;\n  /**\n   * stores the preview image as canvas\n   */\n  @ViewChild('PreviewCanvas', {read: ElementRef}) private previewCanvas: ElementRef;\n  /**\n   * an array of points used by the crop tool\n   */\n  private points: Array<PointPositionChange>;\n\n  // ************** //\n  // EVENT EMITTERS //\n  // ************** //\n  /**\n   * optional binding to the exit button of the editor\n   */\n  @Output() exitEditor: EventEmitter<string> = new EventEmitter<string>();\n  /**\n   * fires on edit completion\n   */\n  @Output() editResult: EventEmitter<Blob> = new EventEmitter<Blob>();\n  /**\n   * emits errors, can be linked to an error handler of choice\n   */\n  @Output() error: EventEmitter<any> = new EventEmitter<any>();\n  /**\n   * emits the loading status of the cv module.\n   */\n  @Output() ready: EventEmitter<boolean> = new EventEmitter<boolean>();\n  /**\n   * emits true when processing is done, false when completed\n   */\n  @Output() processing: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  // ****** //\n  // INPUTS //\n  // ****** //\n  /**\n   * set image for editing\n   * @param file - file from form input\n   */\n  @Input() set file(file: File) {\n    if (file) {\n      setTimeout(() => {\n        this.processing.emit(true);\n      }, 5);\n      this.imageLoaded = false;\n      this.originalImage = file;\n      this.ngxOpenCv.cvState.subscribe(\n        async (cvState: OpenCVState) => {\n          if (cvState.ready) {\n            // read file to image & canvas\n            await this.loadFile(file);\n            this.processing.emit(false);\n          }\n        });\n    }\n  }\n\n  /**\n   * editor configuration object\n   */\n  @Input() config: DocScannerConfig;\n\n\n  constructor(private ngxOpenCv: NgxOpenCVService, private limitsService: LimitsService, private bottomSheet: MatBottomSheet) {\n    this.screenDimensions = {\n      width: window.innerWidth,\n      height: window.innerHeight\n    };\n\n    // subscribe to status of cv module\n    this.ngxOpenCv.cvState.subscribe((cvState: OpenCVState) => {\n      this.cvState = cvState.state;\n      this.ready.emit(cvState.ready);\n      if (cvState.error) {\n        this.error.emit(new Error('error loading cv'));\n      } else if (cvState.loading) {\n        this.processing.emit(true);\n      } else if (cvState.ready) {\n        this.processing.emit(false);\n      }\n    });\n\n    // subscribe to positions of crop tool\n    this.limitsService.positions.subscribe(points => {\n      this.points = points;\n    });\n  }\n\n  ngOnInit() {\n    // set options from config object\n    this.options = new ImageEditorConfig(this.config);\n    // set export image icon\n    this.editorButtons.forEach(button => {\n      if (button.name === 'upload') {\n        button.icon = this.options.exportImageIcon;\n      }\n    });\n    this.maxPreviewWidth = this.options.maxPreviewWidth;\n    this.editorStyle = this.options.editorStyle;\n  }\n\n  // ***************************** //\n  // editor action buttons methods //\n  // ***************************** //\n\n  /**\n   * emits the exitEditor event\n   */\n  exit() {\n    this.exitEditor.emit('canceled');\n  }\n\n  /**\n   * applies the selected filter, and when done emits the resulted image\n   */\n  private async exportImage() {\n    await this.applyFilter(false);\n    if (this.options.maxImageDimensions) {\n      this.resize(this.editedImage)\n        .then(resizeResult => {\n          resizeResult.toBlob((blob) => {\n            this.editResult.emit(blob);\n            this.processing.emit(false);\n          }, this.originalImage.type);\n        });\n    } else {\n      this.editedImage.toBlob((blob) => {\n        this.editResult.emit(blob);\n        this.processing.emit(false);\n      }, this.originalImage.type);\n    }\n  }\n\n  /**\n   * open the bottom sheet for selecting filters, and applies the selected filter in preview mode\n   */\n  private chooseFilters() {\n    const data = { filter: this.selectedFilter };\n    const bottomSheetRef = this.bottomSheet.open(NgxFilterMenuComponent, {\n      data: data\n    });\n    bottomSheetRef.afterDismissed().subscribe(() => {\n      this.selectedFilter = data.filter;\n      this.applyFilter(true);\n    });\n\n  }\n\n  // *************************** //\n  // File Input & Output Methods //\n  // *************************** //\n  /**\n   * load image from input field\n   */\n  private loadFile(file: File) {\n    return new Promise(async (resolve, reject) => {\n      this.processing.emit(true);\n      try {\n        await this.readImage(file);\n      } catch (err) {\n        console.error(err);\n        this.error.emit(new Error(err));\n      }\n      try {\n        await this.showPreview();\n      } catch (err) {\n        console.error(err);\n        this.error.emit(new Error(err));\n      }\n      // set pane limits\n      // show points\n      this.imageLoaded = true;\n      await this.limitsService.setPaneDimensions({width: this.previewDimensions.width, height: this.previewDimensions.height});\n      setTimeout(async () => {\n        await this.detectContours();\n        this.processing.emit(false);\n        resolve();\n      }, 15);\n    });\n  }\n\n  /**\n   * read image from File object\n   */\n  private readImage(file: File) {\n    return new Promise(async (resolve, reject) => {\n      let imageSrc;\n      try {\n        imageSrc = await readFile();\n      } catch (err) {\n        reject(err);\n      }\n      const img = new Image();\n      img.onload = async () => {\n        // set edited image canvas and dimensions\n        this.editedImage = <HTMLCanvasElement> document.createElement('canvas');\n        this.editedImage.width = img.width;\n        this.editedImage.height = img.height;\n        const ctx = this.editedImage.getContext('2d');\n        ctx.drawImage(img, 0, 0);\n        // resize image if larger than max image size\n        const width = img.width > img.height ? img.height : img.width;\n        if (width > this.options.maxImageDimensions.width) {\n          this.editedImage = await this.resize(this.editedImage);\n        }\n        this.imageDimensions.width = this.editedImage.width;\n        this.imageDimensions.height = this.editedImage.height;\n        this.setPreviewPaneDimensions(this.editedImage);\n        resolve();\n      };\n      img.src = imageSrc;\n    });\n\n    /**\n     * read file from input field\n     */\n    function readFile() {\n      return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = (event) => {\n          resolve(reader.result);\n        };\n        reader.onerror = (err) => {\n          reject(err);\n        };\n        reader.readAsDataURL(file);\n      });\n    }\n  }\n\n  // ************************ //\n  // Image Processing Methods //\n  // ************************ //\n  /**\n   * rotate image 90 degrees\n   */\n  private rotateImage() {\n    return new Promise((resolve, reject) => {\n      this.processing.emit(true);\n      setTimeout(() => {\n        const dst = cv.imread(this.editedImage);\n        // const dst = new cv.Mat();\n        cv.transpose(dst, dst);\n        cv.flip(dst, dst, 1);\n        cv.imshow(this.editedImage, dst);\n        // src.delete();\n        dst.delete();\n        // save current preview dimensions and positions\n        const initialPreviewDimensions = {width: 0, height: 0};\n        Object.assign(initialPreviewDimensions, this.previewDimensions);\n        const initialPositions = Array.from(this.points);\n        // get new dimensions\n        // set new preview pane dimensions\n        this.setPreviewPaneDimensions(this.editedImage);\n        // get preview pane resize ratio\n        const previewResizeRatios = {\n          width: this.previewDimensions.width / initialPreviewDimensions.width,\n          height: this.previewDimensions.height / initialPreviewDimensions.height\n        };\n        // set new preview pane dimensions\n\n        this.limitsService.rotateClockwise(previewResizeRatios, initialPreviewDimensions, initialPositions);\n        this.showPreview().then(() => {\n          this.processing.emit(false);\n          resolve();\n        });\n      }, 30);\n    });\n\n\n  }\n\n  /**\n   * detects the contours of the document and\n   **/\n  private detectContours(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.processing.emit(true);\n      setTimeout(() => {\n        // load the image and compute the ratio of the old height to the new height, clone it, and resize it\n        const processingResizeRatio = 0.5;\n        const dst = cv.imread(this.editedImage);\n        const dsize = new cv.Size(dst.rows * processingResizeRatio, dst.cols * processingResizeRatio);\n        const ksize = new cv.Size(5, 5);\n        // convert the image to grayscale, blur it, and find edges in the image\n        cv.cvtColor(dst, dst, cv.COLOR_RGBA2GRAY, 0);\n        cv.GaussianBlur(dst, dst, ksize, 0, 0, cv.BORDER_DEFAULT);\n        cv.Canny(dst, dst, 75, 200);\n        // find contours\n        cv.threshold(dst, dst, 120, 200, cv.THRESH_BINARY);\n        const contours = new cv.MatVector();\n        const hierarchy = new cv.Mat();\n        cv.findContours(dst, contours, hierarchy, cv.RETR_CCOMP, cv.CHAIN_APPROX_SIMPLE);\n        const rect = cv.boundingRect(dst);\n        dst.delete(); hierarchy.delete(); contours.delete();\n        // transform the rectangle into a set of points\n        Object.keys(rect).forEach(key => {\n          rect[key] = rect[key]  * this.imageResizeRatio;\n        });\n\n        const contourCoordinates = [\n          new PositionChangeData({x: rect.x, y: rect.y}, ['left', 'top']),\n          new PositionChangeData({x: rect.x + rect.width, y: rect.y}, ['right', 'top']),\n          new PositionChangeData({x: rect.x + rect.width, y: rect.y + rect.height}, ['right', 'bottom']),\n          new PositionChangeData({x: rect.x, y: rect.y + rect.height}, ['left', 'bottom']),\n        ];\n\n        this.limitsService.repositionPoints(contourCoordinates);\n        // this.processing.emit(false);\n        resolve();\n      }, 30);\n    });\n  }\n\n  /**\n   * apply perspective transform\n   */\n  private transform(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.processing.emit(true);\n      setTimeout(() => {\n        const dst = cv.imread(this.editedImage);\n\n        // create source coordinates matrix\n        const sourceCoordinates = [\n          this.getPoint(['top', 'left']),\n          this.getPoint(['top', 'right']),\n          this.getPoint(['bottom', 'right']),\n          this.getPoint(['bottom', 'left'])\n        ].map(point => {\n          return [point.x / this.imageResizeRatio, point.y / this.imageResizeRatio];\n        });\n\n        // get max width\n        const bottomWidth = this.getPoint(['bottom', 'right']).x - this.getPoint(['bottom', 'left']).x;\n        const topWidth = this.getPoint(['top', 'right']).x - this.getPoint(['top', 'left']).x;\n        const maxWidth = Math.max(bottomWidth, topWidth) / this.imageResizeRatio;\n        // get max height\n        const leftHeight = this.getPoint(['bottom', 'left']).y - this.getPoint(['top', 'left']).y;\n        const rightHeight = this.getPoint(['bottom', 'right']).y - this.getPoint(['top', 'right']).y;\n        const maxHeight = Math.max(leftHeight, rightHeight) / this.imageResizeRatio;\n        // create dest coordinates matrix\n        const destCoordinates = [\n          [0, 0],\n          [maxWidth - 1, 0],\n          [maxWidth - 1, maxHeight - 1],\n          [0, maxHeight - 1]\n        ];\n\n        // convert to open cv matrix objects\n        const Ms = cv.matFromArray(4, 1, cv.CV_32FC2, [].concat(...sourceCoordinates));\n        const Md = cv.matFromArray(4, 1, cv.CV_32FC2, [].concat(...destCoordinates));\n        const transformMatrix = cv.getPerspectiveTransform(Ms, Md);\n        // set new image size\n        const dsize = new cv.Size(maxWidth, maxHeight);\n        // perform warp\n        cv.warpPerspective(dst, dst, transformMatrix, dsize, cv.INTER_LINEAR, cv.BORDER_CONSTANT, new cv.Scalar());\n        cv.imshow(this.editedImage, dst);\n\n        dst.delete(); Ms.delete(); Md.delete(); transformMatrix.delete();\n\n        this.setPreviewPaneDimensions(this.editedImage);\n        this.showPreview().then(() => {\n          this.processing.emit(false);\n          resolve();\n        });\n      }, 30);\n    });\n  }\n\n  /**\n   * applies the selected filter to the image\n   * @param preview - when true, will not apply the filter to the edited image but only display a preview.\n   * when false, will apply to editedImage\n   */\n  private applyFilter(preview: boolean): Promise<void> {\n    return new Promise(async (resolve, reject) => {\n      this.processing.emit(true);\n      // default options\n      const options = {\n        blur: false,\n        th: true,\n        thMode: cv.ADAPTIVE_THRESH_MEAN_C,\n        thMeanCorrection: 10,\n        thBlockSize: 25,\n        thMax: 255,\n        grayScale: true,\n      };\n      const dst = cv.imread(this.editedImage);\n\n      switch (this.selectedFilter) {\n        case 'original':\n          options.th = false;\n          options.grayScale = false;\n          options.blur = false;\n          break;\n        case 'magic_color':\n          options.grayScale = false;\n          break;\n        case 'bw2':\n          options.thMode = cv.ADAPTIVE_THRESH_GAUSSIAN_C;\n          options.thMeanCorrection = 15;\n          options.thBlockSize = 15;\n          break;\n        case 'bw3':\n          options.blur = true;\n          options.thMeanCorrection = 15;\n          break;\n      }\n\n      setTimeout(async () => {\n        if (options.grayScale) {\n          cv.cvtColor(dst, dst, cv.COLOR_RGBA2GRAY, 0);\n        }\n        if (options.blur) {\n          const ksize = new cv.Size(5, 5);\n          cv.GaussianBlur(dst, dst, ksize, 0, 0, cv.BORDER_DEFAULT);\n        }\n        if (options.th) {\n          if (options.grayScale) {\n            cv.adaptiveThreshold(dst, dst, options.thMax, options.thMode, cv.THRESH_BINARY, options.thBlockSize, options.thMeanCorrection);\n          } else {\n            dst.convertTo(dst, -1, 1, 60);\n            cv.threshold(dst, dst, 170, 255, cv.THRESH_BINARY);\n          }\n        }\n        if (!preview) {\n          cv.imshow(this.editedImage, dst);\n        }\n        await this.showPreview(dst);\n        this.processing.emit(false);\n        resolve();\n      }, 30);\n    });\n  }\n\n  /**\n   * resize an image to fit constraints set in options.maxImageDimensions\n   */\n  private resize(image: HTMLCanvasElement): Promise<HTMLCanvasElement> {\n    return new Promise((resolve, reject) => {\n      this.processing.emit(true);\n      setTimeout(() => {\n        const src = cv.imread(image);\n        const currentDimensions = {\n          width: src.size().width,\n          height: src.size().height\n        };\n        const resizeDimensions = {\n          width: 0,\n          height: 0\n        };\n        if (currentDimensions.width > this.options.maxImageDimensions.width) {\n          resizeDimensions.width = this.options.maxImageDimensions.width;\n          resizeDimensions.height = this.options.maxImageDimensions.width / currentDimensions.width * currentDimensions.height;\n          if (resizeDimensions.height > this.options.maxImageDimensions.height) {\n            resizeDimensions.height = this.options.maxImageDimensions.height;\n            resizeDimensions.width = this.options.maxImageDimensions.height / currentDimensions.height * currentDimensions.width;\n          }\n          const dsize = new cv.Size(Math.floor(resizeDimensions.width), Math.floor(resizeDimensions.height));\n          cv.resize(src, src, dsize, 0, 0, cv.INTER_AREA);\n          const resizeResult = <HTMLCanvasElement> document.createElement('canvas');\n          cv.imshow(resizeResult, src);\n          src.delete();\n          this.processing.emit(false);\n          resolve(resizeResult);\n        } else {\n          this.processing.emit(false);\n          resolve(image);\n        }\n      }, 30);\n    });\n  }\n\n  /**\n   * display a preview of the image on the preview canvas\n   */\n  private showPreview(image?: any) {\n    return new Promise((resolve, reject) => {\n      let src;\n      if (image) {\n        src = image;\n      } else {\n        src = cv.imread(this.editedImage);\n      }\n      const dst = new cv.Mat();\n      const dsize = new cv.Size(0, 0);\n      cv.resize(src, dst, dsize, this.imageResizeRatio, this.imageResizeRatio, cv.INTER_AREA);\n      cv.imshow(this.previewCanvas.nativeElement, dst);\n      src.delete();\n      dst.delete();\n      resolve();\n    });\n  }\n\n  // *************** //\n  // Utility Methods //\n  // *************** //\n  /**\n   * set preview canvas dimensions according to the canvas element of the original image\n   */\n  private setPreviewPaneDimensions(img: HTMLCanvasElement) {\n    // set preview pane dimensions\n    this.previewDimensions = this.calculateDimensions(img.width, img.height);\n    this.previewCanvas.nativeElement.width = this.previewDimensions.width;\n    this.previewCanvas.nativeElement.height = this.previewDimensions.height;\n    this.imageResizeRatio = this.previewDimensions.width / img.width;\n    this.imageDivStyle = {\n      width: this.previewDimensions.width + this.options.cropToolDimensions.width + 'px',\n      height: this.previewDimensions.height + this.options.cropToolDimensions.height + 'px',\n      'margin-left': `calc((100% - ${this.previewDimensions.width + 10}px) / 2 + ${this.options.cropToolDimensions.width / 2}px)`,\n      'margin-right': `calc((100% - ${this.previewDimensions.width + 10}px) / 2 - ${this.options.cropToolDimensions.width / 2}px)`,\n    };\n    this.limitsService.setPaneDimensions({width: this.previewDimensions.width, height: this.previewDimensions.height});\n  }\n\n  /**\n   * calculate dimensions of the preview canvas\n   */\n  private calculateDimensions(width: number, height: number): { width: number; height: number; ratio: number} {\n    const ratio = width / height;\n\n    const maxWidth = this.screenDimensions.width > this.maxPreviewWidth ?\n      this.maxPreviewWidth : this.screenDimensions.width - 40;\n    const maxHeight = this.screenDimensions.height - 240;\n    const calculated = {\n      width: maxWidth,\n      height: Math.round(maxWidth / ratio),\n      ratio: ratio\n    };\n\n    if (calculated.height > maxHeight) {\n      calculated.height = maxHeight;\n      calculated.width = Math.round(maxHeight * ratio);\n    }\n    return calculated;\n  }\n\n  /**\n   * returns a point by it's roles\n   * @param roles - an array of roles by which the point will be fetched\n   */\n  private getPoint(roles: RolesArray) {\n    return this.points.find(point => {\n      return this.limitsService.compareArray(point.roles, roles);\n    });\n  }\n}\n\n/**\n * a class for generating configuration objects for the editor\n */\nclass ImageEditorConfig implements DocScannerConfig {\n  /**\n   * max dimensions of oputput image. if set to zero\n   */\n  maxImageDimensions: ImageDimensions = {\n    width: 800,\n    height: 1200\n  };\n  /**\n   * background color of the main editor div\n   */\n  editorBackgroundColor = '#fefefe';\n  /**\n   * css properties for the main editor div\n   */\n  editorDimensions: { width: string; height: string; } = {\n    width: '100vw',\n    height: '100vh'\n  };\n  /**\n   * css that will be added to the main div of the editor component\n   */\n  extraCss: {[key: string]: string|number} = {\n    position: 'absolute',\n    top: 0,\n    left: 0\n  };\n\n  /**\n   * material design theme color name\n   */\n  buttonThemeColor: 'primary'|'warn'|'accent' = 'accent';\n  /**\n   * icon for the button that completes the editing and emits the edited image\n   */\n  exportImageIcon = 'cloud_upload';\n  /**\n   * color of the crop tool\n   */\n  cropToolColor = '#3cabe2';\n  /**\n   * shape of the crop tool, can be either a rectangle or a circle\n   */\n  cropToolShape: PointShape = 'rect';\n  /**\n   * dimensions of the crop tool\n   */\n  cropToolDimensions: ImageDimensions = {\n    width: 10,\n    height: 10\n  };\n  /**\n   * aggregation of the properties regarding point attributes generated by the class constructor\n   */\n  pointOptions: PointOptions;\n  /**\n   * aggregation of the properties regarding the editor style generated by the class constructor\n   */\n  editorStyle?: {[key: string]: string|number};\n  /**\n   * crop tool outline width\n   */\n  cropToolLineWeight = 3;\n  /**\n   * maximum size of the preview pane\n   */\n  maxPreviewWidth = 800;\n\n  constructor(options: DocScannerConfig) {\n    if (options) {\n      Object.keys(options).forEach(key => {\n        this[key] = options[key];\n      });\n    }\n\n    this.editorStyle = {'background-color': this.editorBackgroundColor };\n    Object.assign(this.editorStyle, this.editorDimensions);\n    Object.assign(this.editorStyle, this.extraCss);\n\n    this.pointOptions = {\n      shape: this.cropToolShape,\n      color: this.cropToolColor,\n      width: 0,\n      height: 0\n    };\n    Object.assign(this.pointOptions, this.cropToolDimensions);\n  }\n}\n\n","import {ModuleWithProviders, NgModule} from '@angular/core';\nimport {NgxDraggablePointComponent} from './components/draggable-point/ngx-draggable-point.component';\nimport {NgxFilterMenuComponent} from './components/filter-menu/ngx-filter-menu.component';\nimport {NgxShapeOutlineComponent} from './components/shape-outline/ngx-shape-outline.component';\nimport {NgxDocScannerComponent} from './components/image-editor/ngx-doc-scanner.component';\nimport {LimitsService} from './services/limits.service';\nimport {FlexLayoutModule} from '@angular/flex-layout';\nimport {AngularDraggableModule} from 'angular2-draggable';\nimport {CommonModule} from '@angular/common';\nimport {OpenCVConfig} from './PublicModels';\nimport {NgxOpenCVModule} from 'ngx-opencv';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatBottomSheetModule } from '@angular/material/bottom-sheet';\nimport { MatListModule } from '@angular/material/list';\nimport {NgxOpenCVService, OpenCvConfigToken} from 'ngx-opencv';\n\n@NgModule({\n  declarations: [\n    NgxDraggablePointComponent,\n    NgxFilterMenuComponent,\n    NgxShapeOutlineComponent,\n    NgxDocScannerComponent,\n  ],\n  imports: [\n    FlexLayoutModule,\n    MatButtonModule,\n    MatIconModule,\n    MatBottomSheetModule,\n    MatListModule,\n    AngularDraggableModule,\n    CommonModule,\n    NgxOpenCVModule,\n  ],\n  exports: [\n    FlexLayoutModule,\n    MatButtonModule,\n    MatIconModule,\n    MatBottomSheetModule,\n    MatListModule,\n    AngularDraggableModule,\n    NgxDocScannerComponent,\n  ],\n  entryComponents: [\n    NgxFilterMenuComponent,\n  ],\n  providers: [\n    NgxOpenCVService,\n    LimitsService,\n  ]\n})\nexport class NgxDocumentScannerModule {\n  static forRoot(config: OpenCVConfig): ModuleWithProviders {\n    return {\n      ngModule: NgxDocumentScannerModule,\n      providers: [\n        { provide: OpenCvConfigToken, useValue: config },\n      ],\n    };\n  }\n}\n"]}